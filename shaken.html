<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>è»Šæ¤œ æ¦‚ç®—ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
    <script
      charset="utf-8"
      src="https://static.line-scdn.net/liff/edge/2/sdk.js"
    ></script>
    <script>
      window.LIFF_ID = "2008228464-kZBg7yrq";
    </script>

    <style>
      :root {
        --bg: #0f172a;
        --card: #fff;
        --muted: #64748b;
        --accent: #4f46e5;
        --ok: #10b981;
        --danger: #ef4444;
        --bd: #e5e7eb;
        --warning: #f59e0b;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        background: linear-gradient(135deg, #4f46e5 0%, #0ea5e9 100%);
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
          "Noto Sans JP", sans-serif;
        color: #0f172a;
      }
      .wrap {
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
      }
      .grid {
        display: grid;
        gap: 16px;
      }
      .card {
        background: var(--card);
        border-radius: 18px;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
        padding: 18px;
      }
      .title {
        font-size: 22px;
        font-weight: 800;
        margin: 0 0 6px;
      }
      .sub {
        color: var(--muted);
        font-size: 13px;
        margin: 0 0 12px;
      }
      .row {
        display: grid;
        gap: 12px;
        grid-template-columns: 1fr;
      }
      @media (min-width: 820px) {
        .row {
          grid-template-columns: 1fr 1fr;
        }
      }
      label small {
        color: var(--muted);
      }
      .field {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .field input[type="number"],
      .field input[type="month"],
      .field input[type="date"],
      .field select {
        border: 2px solid var(--bd);
        border-radius: 10px;
        padding: 12px;
        font-size: 16px;
        outline: none;
        transition: 0.15s;
      }
      .field input:focus,
      .field select:focus {
        border-color: var(--accent);
      }
      .box {
        border: 2px dashed var(--bd);
        border-radius: 12px;
        padding: 12px;
      }
      .opt {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px dashed var(--bd);
      }
      .opt:last-child {
        border-bottom: none;
      }
      .price {
        font-variant-numeric: tabular-nums;
      }
      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        background: var(--accent);
        color: #fff;
        border: 0;
        border-radius: 12px;
        padding: 14px 16px;
        font-weight: 800;
        cursor: pointer;
      }
      .btn.sec {
        background: #0ea5e9;
      }
      .btn.ghost {
        background: #fff;
        color: #111;
        border: 2px solid var(--bd);
      }
      .btn.success {
        background: var(--ok);
      }
      .btn.outline {
        background: #fff;
        color: #111;
        border: 2px solid var(--bd);
      }
      .total {
        font-size: 26px;
        font-weight: 900;
      }
      .line {
        height: 1px;
        background: var(--bd);
        margin: 8px 0;
      }
      .muted {
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: #eef2ff;
        color: #3730a3;
        padding: 3px 8px;
        border-radius: 999px;
        font-size: 12px;
      }
      .badge.warning {
        background: #fef3c7;
        color: #92400e;
      }
      .footer {
        color: #fff;
        opacity: 0.9;
        text-align: center;
        margin-top: 14px;
        font-size: 12px;
      }
      .highlight-box {
        background: #fef3c7;
        border: 2px solid #fbbf24;
        border-radius: 12px;
        padding: 16px;
        margin-top: 12px;
      }
      .big-number {
        font-size: 32px;
        font-weight: 900;
        color: var(--accent);
        margin: 8px 0;
      }
      .alert {
        background: #fee2e2;
        border: 2px solid #ef4444;
        border-radius: 12px;
        padding: 12px;
        margin-top: 12px;
        color: #991b1b;
      }
      .radio-group {
        display: flex;
        gap: 12px;
        margin-top: 8px;
      }
      .radio-item {
        flex: 1;
        border: 2px solid var(--bd);
        border-radius: 10px;
        padding: 12px;
        cursor: pointer;
        transition: 0.2s;
        text-align: center;
      }
      .radio-item:hover {
        border-color: var(--accent);
        background: #f8f9ff;
      }
      .radio-item input {
        margin-right: 6px;
      }
      .info-box {
        background: #e0e7ff;
        border-radius: 10px;
        padding: 12px;
        margin-top: 8px;
        font-size: 14px;
      }
      .section-divider {
        display: flex;
        align-items: center;
        gap: 12px;
        margin: 18px 0;
      }
      .section-divider .bar {
        flex: 1;
        height: 2px;
        background: linear-gradient(90deg, #c7d2fe, #e5e7eb);
      }
      .section-divider .label {
        font-weight: 800;
        color: #334155;
        background: #fff;
        padding: 6px 10px;
        border-radius: 10px;
        border: 1px solid #e5e7eb;
      }
      .section-actions {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        margin-top: 12px;
      }
      .mode-tabs {
        display: flex;
        gap: 10px;
        margin: 6px 0 12px;
      }
      .mode-tab {
        flex: 1;
        border: 2px solid var(--bd);
        border-radius: 10px;
        padding: 10px 12px;
        text-align: center;
        cursor: pointer;
      }
      .mode-tab.active {
        border-color: var(--accent);
        background: #eef2ff;
      }
      .hidden {
        display: none !important;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <!-- â–¼ æº€æœŸæ—¥è¨ˆç®—ã‚«ãƒ¼ãƒ‰ -->
      <div class="card" id="expiryCard">
        <h1 class="title">ğŸ—“ï¸ è»Šæ¤œæº€æœŸæ—¥ è¨ˆç®—</h1>
        <p class="sub">
          ã€Œè»Šæ¤œè¨¼ã®æœ‰åŠ¹æœŸé™ã‚’ç›´æ¥å…¥åŠ›ã€ã¾ãŸã¯ã€Œåˆå¹´åº¦ç™»éŒ²ï¼ˆå¹´æœˆï¼‰ã‹ã‚‰è‡ªå‹•è¨ˆç®—ã€ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚
        </p>

        <div class="mode-tabs">
          <div class="mode-tab active" id="tabDirect">
            è»Šæ¤œè¨¼ã®æœ‰åŠ¹æœŸé™ã‚’ç›´æ¥å…¥åŠ›
          </div>
          <div class="mode-tab" id="tabCalc">åˆå¹´åº¦ç™»éŒ²ã‹ã‚‰è‡ªå‹•è¨ˆç®—</div>
        </div>

        <div id="directPane">
          <div class="field">
            <label>è»Šæ¤œè¨¼ã®æœ‰åŠ¹æœŸé™ <small>ï¼ˆæ—¥ä»˜ã‚’å…¥åŠ›ï¼‰</small></label>
            <input type="date" id="expiryDirect" />
          </div>
        </div>

        <div id="calcPane" class="hidden">
          <div class="grid row">
            <div class="field">
              <label>åˆå¹´åº¦ç™»éŒ²ï¼ˆå¹´æœˆï¼‰</label>
              <input
                type="month"
                id="registrationDate"
                placeholder="ä¾‹: 2012-01"
              />
            </div>
            <div class="field">
              <label>è»Šä¸¡ã‚¿ã‚¤ãƒ—</label>
              <div class="radio-group">
                <label class="radio-item"
                  ><input type="radio" name="carType" value="new" checked />
                  æ–°è»Š</label
                >
                <label class="radio-item"
                  ><input type="radio" name="carType" value="used" />
                  ä¸­å¤ãƒ»ç¶™ç¶š</label
                >
              </div>
            </div>
          </div>
        </div>

        <button
          class="btn"
          id="calcExpiryBtn"
          style="width: 100%; margin-top: 12px"
        >
          è»Šæ¤œæº€æœŸæ—¥ã‚’è¨ˆç®— / åæ˜ ã™ã‚‹
        </button>

        <div id="expiryResult" style="display: none; margin-top: 16px">
          <div class="highlight-box">
            <div style="text-align: center">
              <div
                class="badge warning"
                style="font-size: 14px; margin-bottom: 8px"
              >
                æ¬¡å›è»Šæ¤œæº€æœŸæ—¥
              </div>
              <div class="big-number" id="expiryDate">â€”</div>
              <div
                id="daysRemaining"
                class="muted"
                style="font-size: 16px; margin-top: 4px"
              >
                â€”
              </div>
            </div>
          </div>
          <div id="alertBox" class="alert" style="display: none"></div>

          <div class="section-actions">
            <button class="btn success" id="registerExpiryBtn">
              ğŸ“… ç™»éŒ²ã—ã¦ãƒªãƒã‚¤ãƒ³ãƒ‰ã‚’å—ã‘å–ã‚‹
            </button>
            <button class="btn outline" id="closeExpiryBtn">é–‰ã˜ã‚‹</button>
          </div>
        </div>
      </div>

      <!-- â–¼ åŒºåˆ‡ã‚Šç·š -->
      <div class="section-divider">
        <span class="bar"></span
        ><span class="label">ã“ã“ã‹ã‚‰æ¦‚ç®—ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</span
        ><span class="bar"></span>
      </div>

      <!-- â–¼ è»Šæ¤œè²»ç”¨æ¦‚ç®—ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ -->
      <div class="card" id="simCard">
        <h1 class="title">è»Šæ¤œ æ¦‚ç®—ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
        <p class="sub">â€»æ¦‚ç®—ã®ç›®å®‰ã§ã™ã€‚åº—èˆ—è¨­å®šã«åˆã‚ã›ã¦èª¿æ•´ã—ã¦ãã ã•ã„ã€‚</p>

        <div class="grid row">
          <div class="field">
            <label>è»Šä¸¡åŒºåˆ†</label>
            <select id="carClass">
              <option value="kei">è»½è‡ªå‹•è»Š</option>
              <option value="small">å°å‹ï¼ˆã€œ1.0tï¼‰</option>
              <option value="mid">ä¸­å‹ï¼ˆ1.0tã€œ1.5tï¼‰</option>
              <option value="large">å¤§å‹ï¼ˆ1.5tã€œ2.0tï¼‰</option>
              <option value="xl">ç‰¹å¤§ï¼ˆ2.0tã€œ2.5tï¼‰</option>
            </select>
          </div>
          <div class="field">
            <label>çµŒéå¹´æ•°</label>
            <select id="ageYears">
              <option value="0-13">ã€œ13å¹´</option>
              <option value="13-18">13ã€œ18å¹´</option>
              <option value="18+">18å¹´ä»¥ä¸Š</option>
            </select>
          </div>
        </div>

        <div class="box" style="margin-top: 12px">
          <div class="opt"><strong>ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ•´å‚™ï¼ˆä»»æ„ï¼‰</strong></div>
          <div class="opt">
            <label
              ><input
                type="checkbox"
                class="optChk"
                data-label="ã‚ªã‚¤ãƒ«äº¤æ›"
                data-price="3500"
              />
              ã‚ªã‚¤ãƒ«äº¤æ›</label
            ><span>Â¥3,500</span>
          </div>
          <div class="opt">
            <label
              ><input
                type="checkbox"
                class="optChk"
                data-label="ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆäº¤æ›"
                data-price="1500"
              />
              ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆäº¤æ›</label
            ><span>Â¥1,500</span>
          </div>
        </div>

        <div style="margin-top: 12px">
          <button class="btn" id="calcBtn">æ¦‚ç®—ã‚’è¨ˆç®—ã™ã‚‹</button>
          <button class="btn ghost" id="resetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>

        <div id="resultBox" style="margin-top: 16px; display: none">
          <div class="highlight-box">
            <div
              id="totalPrice"
              style="font-size: 22px; font-weight: 900; color: var(--accent)"
            >
              â€”
            </div>
            <div
              id="summaryText"
              class="muted"
              style="white-space: pre-line; margin-top: 8px"
            ></div>
          </div>
          <div class="section-actions">
            <button class="btn sec" id="sendBtn">LINEã«é€ã‚‹</button>
            <button class="btn outline" id="closeSimBtn">é–‰ã˜ã‚‹</button>
          </div>
        </div>
      </div>

      <p class="footer">
        â€»å®Ÿéš›ã®è²»ç”¨ã¯è»Šä¸¡çŠ¶æ…‹ã‚„æ³•æ”¹å®šã§å¤‰ã‚ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
      </p>
    </div>

    <script>
      const el = (s) => document.querySelector(s);
      const els = (s) => [...document.querySelectorAll(s)];
      function toast(m, ok = true) {
        const n = document.createElement("div");
        n.textContent = m;
        n.style.cssText = `position:fixed;left:50%;top:16px;transform:translateX(-50%);
      background:${
        ok ? "#10b981" : "#ef4444"
      };color:#fff;padding:10px 14px;border-radius:999px;font-weight:700;z-index:9999`;
        document.body.appendChild(n);
        setTimeout(() => n.remove(), 2000);
      }

      // ================== æº€æœŸæ—¥è¨ˆç®— ==================
      let calculatedExpiryDate = null;
      const tabDirect = el("#tabDirect"),
        tabCalc = el("#tabCalc");
      const directPane = el("#directPane"),
        calcPane = el("#calcPane");
      let inputMode = "direct";

      function clearExpiryUI() {
        el("#expiryResult").style.display = "none";
      }
      function setMode(mode) {
        inputMode = mode;
        clearExpiryUI();
        if (mode === "direct") {
          tabDirect.classList.add("active");
          tabCalc.classList.remove("active");
          directPane.classList.remove("hidden");
          calcPane.classList.add("hidden");
          el("#registrationDate").value = "";
        } else {
          tabCalc.classList.add("active");
          tabDirect.classList.remove("active");
          calcPane.classList.remove("hidden");
          directPane.classList.add("hidden");
          el("#expiryDirect").value = "";
        }
      }
      tabDirect.onclick = () => setMode("direct");
      tabCalc.onclick = () => setMode("calc");

      function endOfMonth(y, m) {
        return new Date(y, m, 0).getDate();
      }
      function calculateExpiryDate() {
        const now = new Date();
        if (inputMode === "direct") {
          const v = el("#expiryDirect").value;
          if (!v) return toast("æ—¥ä»˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„", false);
          calculatedExpiryDate = new Date(v + "T00:00:00");
        } else {
          const v = el("#registrationDate").value;
          if (!v) return toast("åˆå¹´åº¦ç™»éŒ²ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„", false);
          const carType = document.querySelector(
            'input[name="carType"]:checked'
          ).value;
          const [y0, m0] = v.split("-").map(Number);
          let y = y0 + (carType === "new" ? 3 : 2),
            m = m0;
          let d = new Date(y, m - 1, endOfMonth(y, m));
          while (d < now) {
            y += 2;
            d = new Date(y, m - 1, endOfMonth(y, m));
          }
          calculatedExpiryDate = d;
        }
        const d = calculatedExpiryDate;
        const diff = Math.ceil((d - now) / (1000 * 60 * 60 * 24));
        el("#expiryDate").textContent = `${d.getFullYear()}å¹´${
          d.getMonth() + 1
        }æœˆ${d.getDate()}æ—¥`;
        el("#daysRemaining").textContent = `ã‚ã¨${diff}æ—¥`;
        const alertBox = el("#alertBox");
        if (diff <= 0) {
          alertBox.textContent = "ğŸš¨ è»Šæ¤œåˆ‡ã‚Œï¼";
          alertBox.style.display = "block";
        } else if (diff <= 30) {
          alertBox.textContent = `âš ï¸ ã‚ã¨${diff}æ—¥`;
          alertBox.style.display = "block";
        } else alertBox.style.display = "none";
        el("#expiryResult").style.display = "block";
      }

      // ================== æ¦‚ç®—ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ ==================
      const TABLES = {
        weight: {
          kei: 6600,
          small: 16400,
          mid: 24600,
          large: 32800,
          xl: 41000,
        },
        jb: { kei: 17000, car: 17800 },
        stamp: { kei: 1800, car: 1600 },
      };
      function calc() {
        const cls = el("#carClass").value,
          age = el("#ageYears").value;
        const wt = TABLES.weight[cls],
          jb = cls === "kei" ? TABLES.jb.kei : TABLES.jb.car,
          st = cls === "kei" ? TABLES.stamp.kei : TABLES.stamp.car;
        const opts = els(".optChk")
          .filter((c) => c.checked)
          .map((c) => ({ l: c.dataset.label, p: +c.dataset.price }));
        const total = wt + jb + st + opts.reduce((a, b) => a + b.p, 0);
        el("#totalPrice").textContent =
          "æ¦‚ç®—åˆè¨ˆï¼š" + total.toLocaleString() + "å††";
        el("#summaryText").textContent = `æ³•å®šè²»ç”¨åˆè¨ˆï¼šç´„${(
          wt +
          jb +
          st
        ).toLocaleString()}å††\nã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼š${
          opts.map((o) => o.l).join("ã€") || "ãªã—"
        }\nåˆè¨ˆï¼šç´„${total.toLocaleString()}å††`;
        el("#resultBox").style.display = "block";
      }
      el("#calcBtn").onclick = calc;
      el("#resetBtn").onclick = () => {
        els(".optChk").forEach((c) => (c.checked = false));
        el("#resultBox").style.display = "none";
      };

      // ================== LIFFé€ä¿¡/é–‰ã˜ã‚‹ ==================
      let liffReady = false;
      async function initLiff() {
        try {
          await liff.init({ liffId: window.LIFF_ID });
          liffReady = true;
        } catch (e) {
          console.error(e);
        }
      }
      el("#sendBtn").onclick = async () => {
        if (!liffReady) await initLiff();
        if (!liff.isInClient())
          return toast("LINEã‚¢ãƒ—ãƒªå†…ã§é–‹ã„ã¦ãã ã•ã„", false);
        await liff.sendMessages([
          { type: "text", text: el("#summaryText").textContent },
        ]);
        toast("LINEã«é€ä¿¡ã—ã¾ã—ãŸï¼");
      };
      el("#closeExpiryBtn").onclick = async () => {
        if (!liffReady) await initLiff();
        if (liffReady && liff.isInClient()) liff.closeWindow();
      };
      el("#closeSimBtn").onclick = async () => {
        if (!liffReady) await initLiff();
        if (liffReady && liff.isInClient()) liff.closeWindow();
      };
      el("#calcExpiryBtn").onclick = calculateExpiryDate;
      initLiff();
    </script>
  </body>
</html>
