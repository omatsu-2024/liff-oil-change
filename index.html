<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ã‚ªã‚¤ãƒ«äº¤æ›äºˆç´„</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
      body {
        font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
        margin: 0;
        background: #f7f7fb;
      }
      .wrap {
        max-width: 520px;
        margin: 0 auto;
        padding: 24px;
      }
      .card {
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.06);
        padding: 24px;
      }
      h1 {
        font-size: 20px;
        margin: 0 0 8px;
      }
      .sub {
        color: #666;
        margin: 0 0 20px;
      }
      label {
        display: block;
        font-weight: 600;
        margin: 14px 0 6px;
      }
      input[type="text"],
      input[type="tel"],
      input[type="date"] {
        width: 100%;
        padding: 12px;
        border: 1.8px solid #e5e7eb;
        border-radius: 8px;
      }
      .radios {
        display: grid;
        gap: 10px;
      }
      .radios label {
        display: flex;
        gap: 10px;
        align-items: center;
        border: 1.8px solid #e5e7eb;
        border-radius: 10px;
        padding: 12px;
      }
      button {
        width: 100%;
        border: 0;
        border-radius: 12px;
        padding: 14px;
        font-weight: 700;
        background: #10b981;
        color: #fff;
        margin-top: 18px;
      }
      .muted {
        font-size: 12px;
        color: #888;
        margin-top: 10px;
      }
      .err {
        color: #e11d48;
        margin-top: 8px;
        display: none;
      }
      .ok {
        color: #16a34a;
        margin-top: 8px;
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="card">
        <h1>ğŸš— ã‚ªã‚¤ãƒ«äº¤æ›äºˆç´„</h1>
        <p class="sub">å¿…è¦äº‹é …ã‚’ã”å…¥åŠ›ãã ã•ã„</p>

        <label>ãŠåå‰ *</label>
        <input id="name" type="text" placeholder="å±±ç”°å¤ªéƒ" required />

        <label>é›»è©±ç•ªå· *</label>
        <input id="phone" type="tel" placeholder="090-1234-5678" required />

        <label>å¸Œæœ›æ—¥ *</label>
        <input id="date" type="date" required />

        <label>å¸Œæœ›æ™‚é–“ *</label>
        <div class="radios">
          <label
            ><input
              type="radio"
              name="time"
              value="10:00-12:00"
            />10:00-12:00</label
          >
          <label
            ><input
              type="radio"
              name="time"
              value="13:00-15:00"
            />13:00-15:00</label
          >
          <label
            ><input
              type="radio"
              name="time"
              value="15:00-17:00"
            />15:00-17:00</label
          >
        </div>

        <button id="submit">äºˆç´„ã™ã‚‹</button>
        <div class="muted">é€ä¿¡å¾Œã€LINEãƒˆãƒ¼ã‚¯ã«ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå±Šãã¾ã™ã€‚</div>
        <div id="err" class="err"></div>
        <div id="ok" class="ok">é€ä¿¡ã—ã¾ã—ãŸã€‚ç”»é¢ã‚’é–‰ã˜ã¾ã™ã€‚</div>
      </div>
    </div>

    <script>
      const LIFF_ID = "2008228464-G4Z2gDq3";
      const GAS_URL =
        "https://script.google.com/macros/s/AKfycbwrDVHWagh1naCgIIC_EgOBfva71PWv786tI47AISJP5FugMxa2XMf4R8iLv1WCW1dd/exec";

      let userId = "";

      (async () => {
        try {
          await liff.init({ liffId: LIFF_ID });
          if (!liff.isLoggedIn()) {
            liff.login();
            return;
          }
          const ctx = await liff.getProfile();
          userId = ctx.userId || "";
        } catch (e) {
          showErr("LINEæ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚");
        }
      })();

      document.getElementById("submit").addEventListener("click", async () => {
        const name = val("name"),
          phone = val("phone"),
          date = val("date");
        const time = (() => {
          const el = document.querySelector('input[name="time"]:checked');
          return el ? el.value : "";
        })();

        if (!name || !phone || !date || !time) {
          return showErr("æœªå…¥åŠ›ã®é …ç›®ãŒã‚ã‚Šã¾ã™");
        }

        try {
          // GASã¸ä¿å­˜
          await fetch(GAS_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ userId, name, phone, date, time }),
          });

          // äºˆç´„å—ä»˜ã‚’LINEãƒˆãƒ¼ã‚¯ã¸
          await liff.sendMessages([
            {
              type: "text",
              text: `ã‚ªã‚¤ãƒ«äº¤æ›ã®ã”äºˆç´„ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€‚\n\nãŠåå‰ï¼š${name}\nå¸Œæœ›æ—¥ï¼š${date}\næ™‚é–“å¸¯ï¼š${time}\n\nã‚¹ã‚¿ãƒƒãƒ•ã‚ˆã‚ŠæŠ˜ã‚Šè¿”ã—ã”é€£çµ¡ã—ã¾ã™ã€‚`,
            },
          ]);

          ok("é€ä¿¡ã—ã¾ã—ãŸã€‚ã¾ã‚‚ãªãç”»é¢ã‚’é–‰ã˜ã¾ã™ã€‚");
          setTimeout(() => liff.closeWindow(), 900);
        } catch (e) {
          showErr("é€ä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚");
        }
      });

      function val(id) {
        return document.getElementById(id).value.trim();
      }
      function showErr(msg) {
        const e = document.getElementById("err");
        e.textContent = msg;
        e.style.display = "block";
      }
      function ok(msg) {
        const e = document.getElementById("ok");
        e.textContent = msg;
        e.style.display = "block";
      }
    </script>
  </body>
</html>
