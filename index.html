<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>オイル交換予約</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
      body {
        font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
        margin: 0;
        background: #f7f7fb;
      }
      .wrap {
        max-width: 520px;
        margin: 0 auto;
        padding: 24px;
      }
      .card {
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.06);
        padding: 24px;
      }
      h1 {
        font-size: 20px;
        margin: 0 0 8px;
      }
      .sub {
        color: #666;
        margin: 0 0 20px;
      }
      label {
        display: block;
        font-weight: 600;
        margin: 14px 0 6px;
      }
      input[type="text"],
      input[type="tel"],
      input[type="date"] {
        width: 100%;
        padding: 12px;
        border: 1.8px solid #e5e7eb;
        border-radius: 8px;
      }
      .radios {
        display: grid;
        gap: 10px;
      }
      .radios label {
        display: flex;
        gap: 10px;
        align-items: center;
        border: 1.8px solid #e5e7eb;
        border-radius: 10px;
        padding: 12px;
      }
      button {
        width: 100%;
        border: 0;
        border-radius: 12px;
        padding: 14px;
        font-weight: 700;
        background: #10b981;
        color: #fff;
        margin-top: 18px;
      }
      .muted {
        font-size: 12px;
        color: #888;
        margin-top: 10px;
      }
      .err {
        color: #e11d48;
        margin-top: 8px;
        display: none;
      }
      .ok {
        color: #16a34a;
        margin-top: 8px;
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="card">
        <h1>🚗 オイル交換予約</h1>
        <p class="sub">必要事項をご入力ください</p>

        <label>お名前 *</label>
        <input id="name" type="text" placeholder="山田太郎" required />

        <label>電話番号 *</label>
        <input id="phone" type="tel" placeholder="090-1234-5678" required />

        <label>希望日 *</label>
        <input id="date" type="date" required />

        <label>希望時間 *</label>
        <div class="radios">
          <label
            ><input
              type="radio"
              name="time"
              value="10:00-12:00"
            />10:00-12:00</label
          >
          <label
            ><input
              type="radio"
              name="time"
              value="13:00-15:00"
            />13:00-15:00</label
          >
          <label
            ><input
              type="radio"
              name="time"
              value="15:00-17:00"
            />15:00-17:00</label
          >
        </div>

        <button id="submit">予約する</button>
        <div class="muted">送信後、LINEトークに確認メッセージが届きます。</div>
        <div id="err" class="err"></div>
        <div id="ok" class="ok">送信しました。画面を閉じます。</div>
      </div>
    </div>

    <script>
      const LIFF_ID = "2008228464-G4Z2gDq3";
      const GAS_URL =
        "https://script.google.com/macros/s/AKfycbwrDVHWagh1naCgIIC_EgOBfva71PWv786tI47AISJP5FugMxa2XMf4R8iLv1WCW1dd/exec";

      let userId = "";

      (async () => {
        try {
          await liff.init({ liffId: LIFF_ID });
          if (!liff.isLoggedIn()) {
            liff.login();
            return;
          }
          const ctx = await liff.getProfile();
          userId = ctx.userId || "";
        } catch (e) {
          showErr("LINE接続に失敗しました。時間をおいて再度お試しください。");
        }
      })();

      document.getElementById("submit").addEventListener("click", async () => {
        const name = val("name"),
          phone = val("phone"),
          date = val("date");
        const time = (() => {
          const el = document.querySelector('input[name="time"]:checked');
          return el ? el.value : "";
        })();

        if (!name || !phone || !date || !time) {
          return showErr("未入力の項目があります");
        }

        try {
          // GASへ保存
          await fetch(GAS_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ userId, name, phone, date, time }),
          });

          // 予約受付をLINEトークへ
          await liff.sendMessages([
            {
              type: "text",
              text: `オイル交換のご予約を受け付けました。\n\nお名前：${name}\n希望日：${date}\n時間帯：${time}\n\nスタッフより折り返しご連絡します。`,
            },
          ]);

          ok("送信しました。まもなく画面を閉じます。");
          setTimeout(() => liff.closeWindow(), 900);
        } catch (e) {
          showErr("送信エラーが発生しました。再度お試しください。");
        }
      });

      function val(id) {
        return document.getElementById(id).value.trim();
      }
      function showErr(msg) {
        const e = document.getElementById("err");
        e.textContent = msg;
        e.style.display = "block";
      }
      function ok(msg) {
        const e = document.getElementById("ok");
        e.textContent = msg;
        e.style.display = "block";
      }
    </script>
  </body>
</html>
