<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>æ•´å‚™å±¥æ­´ ãƒã‚¤ãƒšãƒ¼ã‚¸</title>

    <!-- LIFF SDK -->
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script>
      // ==== å¿…è¦ã«å¿œã˜ã¦æ›¸ãæ›ãˆ ====
      window.LIFF_ID   = "2008228464-Jy1OL86j";
      window.GAS_URL   = "https://script.google.com/macros/s/AKfycbz0EzPRsZ77DFPU8qC555lxya1Zo_KHVRbl_Z32WBKRCIKPb5GCDTgNm7mrhcEUUlDH/exec";
      window.POST_TOKEN = "change-me-32chars";
      window.BOOKING_BASE = "https://liff.line.me/2008228464-nMpDkLPK?calendar_salon_id=18905&ts=1760362889";
    </script>

    <style>
      :root { --primary:#16a34a; --warning:#f59e0b; --danger:#ef4444; --gray:#64748b; --light:#f8fafc; --border:#e5e7eb; }
      *{box-sizing:border-box;margin:0;padding:0}
      body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans JP",sans-serif;background:linear-gradient(135deg,#34d399 0%,#16a34a 100%);min-height:100vh;padding:16px;}
      .container{max-width:600px;margin:0 auto;}
      .card{background:#fff;border-radius:16px;padding:20px;margin-bottom:16px;box-shadow:0 4px 12px rgba(0,0,0,.1);}
      .header{display:flex;align-items:center;gap:12px;margin-bottom:20px;}
      .avatar{flex:0 0 60px;width:60px;height:60px;aspect-ratio:1/1;border-radius:50%;background:linear-gradient(135deg,#34d399,#16a34a);display:inline-flex;align-items:center;justify-content:center;color:#fff;font-size:24px;font-weight:700;}
      .user-info h2{font-size:20px;color:#1e293b;margin-bottom:4px;}
      .user-info p{font-size:14px;color:var(--gray);}
      .section-title{font-size:16px;font-weight:700;color:#1e293b;margin-bottom:12px;display:flex;gap:8px;align-items:center;}
      .badge{display:inline-block;padding:4px 10px;border-radius:12px;font-size:12px;font-weight:600;}
      .recommendation{background:var(--light);border-left:4px solid var(--warning);padding:12px;border-radius:8px;margin-bottom:8px;}
      .recommendation.urgent{border-left-color:var(--danger);background:#fef2f2;}
      .loading{text-align:center;padding:40px 20px;color:#fff;}
      .loading-spinner{width:40px;height:40px;border:4px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 16px;}
      @keyframes spin{to{transform:rotate(360deg)}}
      .error{background:#fee2e2;color:#991b1b;padding:16px;border-radius:12px;text-align:center;}
      .empty{text-align:center;padding:40px 20px;color:var(--gray);}
      .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;width:100%;padding:14px;background:var(--primary);color:#fff;border:none;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;}
      .btn.ghost{background:#e5e7eb;color:#111;}
      .btn:disabled{opacity:.6;cursor:default;}
      input,select,button{font-size:16px;}
      .row{display:flex;gap:8px;}
      .date-field{display:flex;align-items:center;border:1px solid var(--border);border-radius:10px;padding:8px 12px;background:#fff;}
      .date-icon{flex:0 0 auto;margin-right:8px;width:24px;height:24px;border:2px solid var(--primary);border-radius:6px;display:grid;place-items:center;color:var(--primary);font-weight:900;cursor:pointer;}
      .date-input{flex:1;border:none;outline:none;font-size:16px;min-height:28px;background:transparent;}
      .date-hint{font-size:12px;color:#6b7280;margin-top:6px;}
      .modal{position:fixed;inset:0;display:none;place-items:center;padding:16px;z-index:9999;}
      .modal.show{display:grid;}
      .modal-backdrop{position:absolute;inset:0;background:rgba(0,0,0,.45);}
      .modal-card{position:relative;background:#fff;border-radius:16px;box-shadow:0 12px 40px rgba(0,0,0,.25);width:min(720px,92vw);max-width:720px;display:flex;flex-direction:column;max-height:88vh;bottom:12px;}
      .modal-header{display:flex;align-items:center;justify-content:space-between;padding:16px 18px;border-bottom:1px solid var(--border);}
      .modal-title{font-size:18px;font-weight:800;display:flex;align-items:center;gap:8px;}
      .modal-close{background:#ecfdf5;color:#065f46;border:none;border-radius:10px;padding:8px 12px;font-weight:700;cursor:pointer;}
      .modal-body{overflow:auto;padding:8px 2px;max-height:60vh;}
      .modal-footer{display:flex;gap:10px;padding:12px;border-top:1px solid var(--border);background:#fff;border-radius:0 0 16px 16px;}
      .modal-card.shrink{bottom:auto;}
      .modal-card.shrink .modal-body{max-height:48vh;}
      .hist{padding:16px 18px;border-bottom:1px solid var(--border);}
      .hist-date{color:#64748b;font-size:14px;margin-bottom:4px;}
      .hist-type{font-size:18px;font-weight:800;color:#111;margin-bottom:4px;}
      .hist-detail{font-size:14px;color:#6b7280;margin-bottom:6px;}
      .hist-meta{display:flex;justify-content:space-between;color:#111;}
      .hist-meta .price{color:var(--primary);font-weight:800;}
      .hist-meta .km{color:#6b7280;}
      .vehicle{padding:12px 18px;border-bottom:1px dashed var(--border);display:grid;gap:6px;}
      .vehicle:last-child{border-bottom:none;}
      .v-title{font-weight:800;color:#111;}
      .v-sub{color:#6b7280;font-size:14px;line-height:1.6;}
      .v-main{display:flex;align-items:center;gap:8px;margin-top:6px;}
      .v-main input{transform:scale(1.2);}
      #inspectionModal .modal-card{width:min(560px,92vw);}
      #inspectionText{color:#444;line-height:1.8;padding:12px 18px;}
      #laterBtn{background:#e5e7eb;color:#111;}
      #bookNowBtn{background:var(--primary);color:#fff;}
    </style>
  </head>
  <body>
    <!-- èª­ã¿è¾¼ã¿ -->
    <div id="loading" class="loading">
      <div class="loading-spinner"></div>
      <p>èª­ã¿è¾¼ã¿ä¸­...</p>
    </div>

    <!-- æœ¬æ–‡ -->
    <div id="content" class="container" style="display: none">
      <div class="card">
        <div class="header">
          <div class="avatar" id="avatar">ğŸ‘¤</div>
          <div class="user-info">
            <h2 id="userName">-</h2>
            <p id="carInfo">-</p>
          </div>
        </div>
        <button class="btn ghost" id="openCarBtn">è»Šä¸¡æƒ…å ±ã‚’è¦‹ã‚‹</button>
      </div>

      <div class="card">
        <div class="section-title">ğŸ”§ æ¬¡å›ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ¨å¥¨</div>
        <div id="recommendations"></div>
      </div>

      <div class="card">
        <div class="section-title">ğŸ“‹ æ•´å‚™å±¥æ­´</div>
        <button class="btn" id="openHistoryBtn">æ•´å‚™å±¥æ­´ã‚’è¦‹ã‚‹</button>
      </div>

      <div class="card">
        <div class="section-title">ğŸ“ èµ°è¡Œè·é›¢ã®æ›´æ–°</div>
        <div class="row">
          <input id="mileageInput" type="number" inputmode="numeric" placeholder="ç¾åœ¨ã®èµ°è¡Œè·é›¢ (km)"
            style="flex:1;padding:12px;border:1px solid var(--border);border-radius:10px;" />
          <button class="btn" id="saveMileageBtn" style="width:auto">ä¿å­˜</button>
        </div>
        <p class="badge" style="margin-top:8px;background:#ecfdf5;color:#065f46">
          æœ€æ–°ã®è·é›¢ã‚’å…¥ã‚Œã‚‹ã¨æ¨å¥¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒè³¢ããªã‚Šã¾ã™
        </p>
      </div>

      <div class="card">
        <div class="section-title">â• æ•´å‚™å±¥æ­´ã‚’è¿½åŠ </div>
        <label style="display:block;font-size:14px;color:#1f2937;margin-bottom:6px">æ•´å‚™æ—¥</label>
        <div class="date-field" id="dateField">
          <div class="date-icon" id="dateIcon">ğŸ“…</div>
          <input id="hDate" type="date" class="date-input" placeholder="yyyy-mm-dd" />
        </div>
        <div class="date-hint">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ ã¾ãŸã¯ å…¥åŠ›æ¬„ã‚’ã‚¿ãƒƒãƒ—ã—ã¦æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„</div>

        <div style="margin-top:12px;display:grid;gap:8px">
          <select id="hTypeSelect" style="padding:12px;border:1px solid var(--border);border-radius:10px;">
            <option value="" disabled selected>æ•´å‚™é …ç›®ã‚’é¸æŠ</option>
            <option>ã‚ªã‚¤ãƒ«äº¤æ›</option><option>ã‚ªã‚¤ãƒ«ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆäº¤æ›</option><option>ã‚¿ã‚¤ãƒ¤äº¤æ›</option>
            <option>ãƒ–ãƒ¬ãƒ¼ã‚­ãƒ•ãƒ«ãƒ¼ãƒ‰äº¤æ›</option><option>å†·å´æ°´ï¼ˆLLCï¼‰äº¤æ›</option><option>ãƒãƒƒãƒ†ãƒªãƒ¼äº¤æ›</option>
            <option>ã‚¨ã‚¢ã‚³ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼äº¤æ›</option><option>ãƒ¯ã‚¤ãƒ‘ãƒ¼ã‚´ãƒ äº¤æ›</option><option>12ãƒ¶æœˆç‚¹æ¤œ</option>
            <option>è»Šæ¤œæ•´å‚™</option><option value="__other__">ãã®ä»–ï¼ˆè‡ªç”±å…¥åŠ›ï¼‰</option>
          </select>
          <input id="hTypeOther" placeholder="ãã®ä»–ã®å†…å®¹ã‚’å…¥åŠ›"
                 style="display:none;padding:12px;border:1px solid var(--border);border-radius:10px;" />
        </div>

        <div class="grid" style="display:grid;gap:8px;margin-top:8px">
          <input id="hDetail" placeholder="ä¾‹: ã‚¨ãƒ³ã‚¸ãƒ³ã‚ªã‚¤ãƒ«äº¤æ›"
                 style="padding:12px;border:1px solid var(--border);border-radius:10px;" />
          <input id=
