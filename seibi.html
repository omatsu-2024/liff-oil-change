<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ•´å‚™å±¥æ­´ãƒã‚¤ãƒšãƒ¼ã‚¸</title>
    <script
      charset="utf-8"
      src="https://static.line-scdn.net/liff/edge/2/sdk.js"
    ></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 600px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px 20px;
        text-align: center;
      }

      .logo {
        width: 120px;
        height: 120px;
        margin: 0 auto 15px;
        background: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .logo img {
        width: 80%;
        height: 80%;
        object-fit: contain;
      }

      .header h1 {
        font-size: 24px;
        margin-bottom: 5px;
      }

      .header p {
        font-size: 14px;
        opacity: 0.9;
      }

      .content {
        padding: 20px;
      }

      .vehicle-card {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .vehicle-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .vehicle-name {
        font-size: 22px;
        font-weight: bold;
        color: #2d3748;
      }

      .change-vehicle-btn {
        background: white;
        border: 2px solid #667eea;
        color: #667eea;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
      }

      .change-vehicle-btn:hover {
        background: #667eea;
        color: white;
      }

      .vehicle-info {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-bottom: 15px;
      }

      .info-item {
        background: white;
        padding: 12px;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      }

      .info-label {
        font-size: 11px;
        color: #718096;
        margin-bottom: 4px;
        font-weight: 600;
      }

      .info-value {
        font-size: 16px;
        color: #2d3748;
        font-weight: bold;
      }

      .inspection-status {
        background: white;
        padding: 15px;
        border-radius: 10px;
        margin-top: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      }

      .inspection-status.urgent {
        background: #fff5f5;
        border-left: 4px solid #f56565;
      }

      .inspection-status.warning {
        background: #fffaf0;
        border-left: 4px solid #ed8936;
      }

      .inspection-status.ok {
        background: #f0fff4;
        border-left: 4px solid #48bb78;
      }

      .status-title {
        font-size: 13px;
        font-weight: bold;
        margin-bottom: 5px;
        color: #2d3748;
      }

      .status-message {
        font-size: 14px;
        color: #4a5568;
        line-height: 1.5;
      }

      .maintenance-recommendations {
        background: #f7fafc;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
      }

      .section-title {
        font-size: 18px;
        font-weight: bold;
        color: #2d3748;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
      }

      .section-title::before {
        content: "ğŸ”§";
        margin-right: 8px;
        font-size: 20px;
      }

      .recommendation-item {
        background: white;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        border-left: 4px solid #667eea;
      }

      .recommendation-item.urgent {
        border-left-color: #f56565;
        background: #fff5f5;
      }

      .recommendation-item.warning {
        border-left-color: #ed8936;
        background: #fffaf0;
      }

      .recommendation-title {
        font-size: 15px;
        font-weight: bold;
        color: #2d3748;
        margin-bottom: 5px;
      }

      .recommendation-message {
        font-size: 13px;
        color: #4a5568;
        line-height: 1.5;
      }

      .history-section {
        margin-top: 20px;
      }

      .history-item {
        background: white;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        border-left: 4px solid #48bb78;
      }

      .history-date {
        font-size: 13px;
        color: #718096;
        margin-bottom: 5px;
      }

      .history-content {
        font-size: 14px;
        color: #2d3748;
        font-weight: 600;
        margin-bottom: 5px;
      }

      .history-mileage {
        font-size: 12px;
        color: #4a5568;
      }

      .action-buttons {
        display: grid;
        grid-template-columns: 1fr;
        gap: 10px;
        margin-top: 20px;
      }

      .btn {
        padding: 15px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        text-align: center;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      .btn-secondary {
        background: white;
        color: #667eea;
        border: 2px solid #667eea;
      }

      .btn-secondary:hover {
        background: #f7fafc;
      }

      .loading {
        text-align: center;
        padding: 40px 20px;
        color: #718096;
      }

      .loading::after {
        content: "...";
        animation: dots 1.5s steps(4, end) infinite;
      }

      @keyframes dots {
        0%,
        20% {
          content: ".";
        }
        40% {
          content: "..";
        }
        60%,
        100% {
          content: "...";
        }
      }

      .error {
        background: #fff5f5;
        color: #c53030;
        padding: 20px;
        border-radius: 10px;
        margin: 20px;
        border-left: 4px solid #f56565;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }

      .modal.show {
        display: flex;
      }

      .modal-content {
        background: white;
        border-radius: 15px;
        padding: 25px;
        max-width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      }

      .modal-header {
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 20px;
        color: #2d3748;
        border-bottom: 2px solid #e2e8f0;
        padding-bottom: 10px;
      }

      .vehicle-option {
        background: #f7fafc;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 10px;
        cursor: pointer;
        border: 2px solid transparent;
        transition: all 0.3s;
      }

      .vehicle-option:hover {
        border-color: #667eea;
        background: #edf2f7;
      }

      .vehicle-option.selected {
        border-color: #667eea;
        background: #e6f2ff;
      }

      .vehicle-option-name {
        font-size: 16px;
        font-weight: bold;
        color: #2d3748;
        margin-bottom: 5px;
      }

      .vehicle-option-info {
        font-size: 13px;
        color: #718096;
      }

      .modal-actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }

      .modal-actions .btn {
        flex: 1;
      }

      .cta-section {
        margin-top: 20px;
        padding: 20px;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        border-radius: 15px;
        text-align: center;
        color: white;
      }

      .cta-title {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 10px;
      }

      .cta-message {
        font-size: 14px;
        margin-bottom: 15px;
        opacity: 0.95;
      }

      .cta-button {
        background: white;
        color: #f5576c;
        padding: 12px 30px;
        border-radius: 25px;
        font-size: 16px;
        font-weight: bold;
        border: none;
        cursor: pointer;
        transition: all 0.3s;
        display: inline-block;
        text-decoration: none;
      }

      .cta-button:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="logo">
          <img
            id="logoImg"
            src="https://omatsu-2024.github.io/liff-oil-change/img/Maintenance_Logo.png"
            alt="æ•´å‚™ãƒ­ã‚´"
          />
        </div>
        <h1>æ•´å‚™å±¥æ­´ãƒã‚¤ãƒšãƒ¼ã‚¸</h1>
        <p id="customerName">ãŠå®¢æ§˜ã®æ•´å‚™æƒ…å ±</p>
      </div>

      <div id="app" class="content">
        <div class="loading">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­</div>
      </div>
    </div>

    <!-- è»Šä¸¡é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="vehicleModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">ğŸš— è»Šä¸¡ã‚’é¸æŠ</div>
        <div id="vehicleList"></div>
        <div class="modal-actions">
          <button class="btn btn-secondary" onclick="closeVehicleModal()">
            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
          </button>
          <button class="btn btn-primary" onclick="switchVehicle()">
            åˆ‡ã‚Šæ›¿ãˆã‚‹
          </button>
        </div>
      </div>
    </div>

    <script>
      // è¨­å®š
      const CONFIG = {
        LIFF_ID: "2008228464-Jy1OL86j",
        GAS_URL:
          "https://script.google.com/macros/s/AKfycbz0EzPRsZ77DFPU8qC555lxya1Zo_KHVRbl_Z32WBKRCIKPb5GCDTgNm7mrhcEUUlDH/exec",
        POST_TOKEN: "change-me-32chars",
        BOOKING_URL:
          "https://liff.line.me/2008228464-nMpDkLPK?calendar_salon_id=18905&ts=1760362889",
      };

      // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
      let userData = null;
      let allVehicles = [];
      let selectedVehicleId = null;

      // LIFFåˆæœŸåŒ–
      window.onload = async function () {
        try {
          console.log("LIFFåˆæœŸåŒ–é–‹å§‹...");
          await liff.init({ liffId: CONFIG.LIFF_ID });
          console.log("LIFFåˆæœŸåŒ–æˆåŠŸ");

          if (!liff.isLoggedIn()) {
            console.log("æœªãƒ­ã‚°ã‚¤ãƒ³ - ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ");
            liff.login();
            return;
          }

          const profile = await liff.getProfile();
          console.log("ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å–å¾—:", profile);

          await loadData(profile.userId);
        } catch (error) {
          console.error("åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:", error);
          showError("åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: " + error.message);
        }
      };

      // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
      async function loadData(userId) {
        try {
          console.log("ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–‹å§‹:", userId);
          const response = await fetch(
            `${CONFIG.GAS_URL}?userId=${encodeURIComponent(userId)}`
          );

          if (!response.ok) {
            throw new Error(`HTTPã‚¨ãƒ©ãƒ¼: ${response.status}`);
          }

          const data = await response.json();
          console.log("å–å¾—ãƒ‡ãƒ¼ã‚¿:", data);

          if (data.error) {
            throw new Error(data.error);
          }

          userData = data;
          allVehicles = data.vehicles || [];

          if (allVehicles.length === 0) {
            showError("ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹è»Šä¸¡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
            return;
          }

          renderContent();
        } catch (error) {
          console.error("ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:", error);
          showError("ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: " + error.message);
        }
      }

      // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æç”»
      function renderContent() {
        const mainVehicle =
          allVehicles.find((v) => v.isPrimary) || allVehicles[0];

        document.getElementById("customerName").textContent =
          userData.customerName || "ãŠå®¢æ§˜";

        const app = document.getElementById("app");
        app.innerHTML = `
                ${renderVehicleCard(mainVehicle)}
                ${renderRecommendations(mainVehicle)}
                ${renderHistory(mainVehicle)}
                ${renderCTA()}
                ${renderActionButtons()}
            `;
      }

      // è»Šä¸¡ã‚«ãƒ¼ãƒ‰æç”»
      function renderVehicleCard(vehicle) {
        const inspectionStatus = getInspectionStatus(vehicle);
        const currentMileage =
          vehicle.currentMileage || vehicle.nowMileage || "æœªç™»éŒ²";

        return `
                <div class="vehicle-card">
                    <div class="vehicle-header">
                        <div class="vehicle-name">${vehicle.vehicleName}</div>
                        ${
                          allVehicles.length > 1
                            ? '<button class="change-vehicle-btn" onclick="openVehicleModal()">è»Šä¸¡å¤‰æ›´</button>'
                            : ""
                        }
                    </div>
                    <div class="vehicle-info">
                        <div class="info-item">
                            <div class="info-label">æ’æ°—é‡</div>
                            <div class="info-value">${
                              vehicle.displacement || "-"
                            }</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">åˆå¹´åº¦ç™»éŒ²</div>
                            <div class="info-value">${
                              vehicle.firstRegistration || "-"
                            }</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">æ¬¡å›è»Šæ¤œæ—¥</div>
                            <div class="info-value">${
                              vehicle.nextInspectionDate || "-"
                            }</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">è»Šæ¤œã¾ã§</div>
                            <div class="info-value">${
                              vehicle.daysUntilInspection || "-"
                            }æ—¥</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">ç¾åœ¨ã®èµ°è¡Œè·é›¢</div>
                            <div class="info-value">${currentMileage}km</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">ãƒŠãƒ³ãƒãƒ¼</div>
                            <div class="info-value">${
                              vehicle.plateNumber || "-"
                            }</div>
                        </div>
                    </div>
                    <div class="inspection-status ${inspectionStatus.class}">
                        <div class="status-title">${
                          inspectionStatus.title
                        }</div>
                        <div class="status-message">${
                          inspectionStatus.message
                        }</div>
                    </div>
                </div>
            `;
      }

      // è»Šæ¤œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¤å®š
      function getInspectionStatus(vehicle) {
        const days = vehicle.daysUntilInspection;
        if (days <= 7) {
          return {
            class: "urgent",
            title: "ğŸš¨ è»Šæ¤œãŒè¿«ã£ã¦ã„ã¾ã™",
            message: `è»Šæ¤œã¾ã§æ®‹ã‚Š${days}æ—¥ã§ã™ã€‚æ—©æ€¥ã«ã”äºˆç´„ãã ã•ã„ã€‚`,
          };
        } else if (days <= 30) {
          return {
            class: "warning",
            title: "âš ï¸ è»Šæ¤œãŒè¿‘ã¥ã„ã¦ã„ã¾ã™",
            message: `è»Šæ¤œã¾ã§æ®‹ã‚Š${days}æ—¥ã§ã™ã€‚ãŠæ—©ã‚ã®ã”äºˆç´„ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚`,
          };
        }
        return {
          class: "ok",
          title: "âœ… è»Šæ¤œã¾ã§ä½™è£•ãŒã‚ã‚Šã¾ã™",
          message: `æ¬¡å›è»Šæ¤œã¾ã§${days}æ—¥ã‚ã‚Šã¾ã™ã€‚`,
        };
      }

      // ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ¨å¥¨æç”»
      function renderRecommendations(vehicle) {
        const recommendations = vehicle.recommendations || [];

        if (recommendations.length === 0) {
          return "";
        }

        const items = recommendations
          .map(
            (rec) => `
                <div class="recommendation-item ${rec.urgency || ""}">
                    <div class="recommendation-title">${rec.type}</div>
                    <div class="recommendation-message">${rec.message}</div>
                </div>
            `
          )
          .join("");

        return `
                <div class="maintenance-recommendations">
                    <div class="section-title">ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ¨å¥¨</div>
                    ${items}
                </div>
            `;
      }

      // æ•´å‚™å±¥æ­´æç”»
      function renderHistory(vehicle) {
        const history = (vehicle.history || []).slice(0, 5);

        if (history.length === 0) {
          return `
                    <div class="history-section">
                        <div class="section-title">ğŸ“ æ•´å‚™å±¥æ­´</div>
                        <div class="info-item">
                            <div class="info-value" style="text-align: center; padding: 20px;">
                                æ•´å‚™å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“
                            </div>
                        </div>
                    </div>
                `;
        }

        const items = history
          .map(
            (h) => `
                <div class="history-item">
                    <div class="history-date">${h.date}</div>
                    <div class="history-content">${h.content}</div>
                    <div class="history-mileage">èµ°è¡Œè·é›¢: ${
                      h.mileage || "-"
                    }km</div>
                </div>
            `
          )
          .join("");

        return `
                <div class="history-section">
                    <div class="section-title">ğŸ“ æ•´å‚™å±¥æ­´ï¼ˆæœ€æ–°5ä»¶ï¼‰</div>
                    ${items}
                </div>
            `;
      }

      // CTAæç”»
      function renderCTA() {
        return `
                <div class="cta-section">
                    <div class="cta-title">ğŸ‰ ä»Šã™ãã”äºˆç´„</div>
                    <div class="cta-message">ã‚ªãƒ³ãƒ©ã‚¤ãƒ³äºˆç´„ã§ã‚¹ãƒ ãƒ¼ã‚ºã«æ•´å‚™ã‚’å—ã‘ã‚‰ã‚Œã¾ã™</div>
                    <a href="${CONFIG.BOOKING_URL}" class="cta-button">äºˆç´„ã™ã‚‹</a>
                </div>
            `;
      }

      // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³æç”»
      function renderActionButtons() {
        return `
                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="updateMileage()">ğŸ“Š èµ°è¡Œè·é›¢ã‚’æ›´æ–°</button>
                    <button class="btn btn-secondary" onclick="addHistory()">ğŸ“ æ•´å‚™å±¥æ­´ã‚’è¿½åŠ </button>
                </div>
            `;
      }

      // è»Šä¸¡é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
      function openVehicleModal() {
        const mainVehicle =
          allVehicles.find((v) => v.isPrimary) || allVehicles[0];
        selectedVehicleId = mainVehicle.vehicleId;

        const list = allVehicles
          .map(
            (v) => `
                <div class="vehicle-option ${
                  v.vehicleId === selectedVehicleId ? "selected" : ""
                }" 
                     onclick="selectVehicle('${v.vehicleId}')">
                    <div class="vehicle-option-name">
                        ${v.isPrimary ? "â­ " : ""}${v.vehicleName}
                    </div>
                    <div class="vehicle-option-info">
                        ${v.displacement || "-"} | æ¬¡å›è»Šæ¤œ: ${
              v.nextInspectionDate || "-"
            }
                    </div>
                </div>
            `
          )
          .join("");

        document.getElementById("vehicleList").innerHTML = list;
        document.getElementById("vehicleModal").classList.add("show");
      }

      // è»Šä¸¡é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
      function closeVehicleModal() {
        document.getElementById("vehicleModal").classList.remove("show");
      }

      // è»Šä¸¡ã‚’é¸æŠ
      function selectVehicle(vehicleId) {
        selectedVehicleId = vehicleId;
        document.querySelectorAll(".vehicle-option").forEach((option) => {
          option.classList.remove("selected");
        });
        event.target.closest(".vehicle-option").classList.add("selected");
      }

      // è»Šä¸¡åˆ‡ã‚Šæ›¿ãˆå®Ÿè¡Œ
      async function switchVehicle() {
        if (!selectedVehicleId) {
          alert("è»Šä¸¡ã‚’é¸æŠã—ã¦ãã ã•ã„");
          return;
        }

        const mainVehicle =
          allVehicles.find((v) => v.isPrimary) || allVehicles[0];
        if (selectedVehicleId === mainVehicle.vehicleId) {
          closeVehicleModal();
          return;
        }

        try {
          const profile = await liff.getProfile();
          const response = await fetch(CONFIG.GAS_URL, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              action: "setPrimary",
              userId: profile.userId,
              vehicleId: selectedVehicleId,
              token: CONFIG.POST_TOKEN,
            }),
          });

          const result = await response.json();

          if (result.success) {
            console.log("ãƒ¡ã‚¤ãƒ³è»Šä¸¡åˆ‡ã‚Šæ›¿ãˆæˆåŠŸ");
            closeVehicleModal();
            await loadData(profile.userId);
          } else {
            throw new Error(result.error || "åˆ‡ã‚Šæ›¿ãˆã«å¤±æ•—ã—ã¾ã—ãŸ");
          }
        } catch (error) {
          console.error("è»Šä¸¡åˆ‡ã‚Šæ›¿ãˆã‚¨ãƒ©ãƒ¼:", error);
          alert("è»Šä¸¡ã®åˆ‡ã‚Šæ›¿ãˆã«å¤±æ•—ã—ã¾ã—ãŸ: " + error.message);
        }
      }

      // èµ°è¡Œè·é›¢æ›´æ–°
      function updateMileage() {
        const mainVehicle =
          allVehicles.find((v) => v.isPrimary) || allVehicles[0];
        const currentMileage =
          mainVehicle.currentMileage || mainVehicle.nowMileage || 0;
        const newMileage = prompt(
          `ç¾åœ¨ã®èµ°è¡Œè·é›¢ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„\nï¼ˆç¾åœ¨: ${currentMileage}kmï¼‰`,
          currentMileage
        );

        if (newMileage && !isNaN(newMileage)) {
          alert(`èµ°è¡Œè·é›¢ã‚’${newMileage}kmã«æ›´æ–°ã—ã¾ã—ãŸ`);
          // å®Ÿéš›ã®æ›´æ–°å‡¦ç†ã¯ã“ã“ã«å®Ÿè£…
        }
      }

      // æ•´å‚™å±¥æ­´è¿½åŠ 
      function addHistory() {
        const content = prompt("æ•´å‚™å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
        if (content) {
          alert("æ•´å‚™å±¥æ­´ã‚’è¿½åŠ ã—ã¾ã—ãŸ: " + content);
          // å®Ÿéš›ã®è¿½åŠ å‡¦ç†ã¯ã“ã“ã«å®Ÿè£…
        }
      }

      // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
      function showError(message) {
        document.getElementById("app").innerHTML = `
                <div class="error">
                    <strong>ã‚¨ãƒ©ãƒ¼</strong><br>
                    ${message}
                </div>
            `;
      }
    </script>
  </body>
</html>
